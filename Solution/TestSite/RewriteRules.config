<rules name="TestRules">
  <clear />
  
  <rule name="Icon" stopProcessing="true">
    <match url="*.ico" patternSyntax="Wildcard" />
    <action type="Rewrite" url="{URL}" />
  </rule>
  
  <rule name="Must be lower case" stopProcessing="true">
    <match url=".*[A-Z].*" ignoreCase="false" />
    <conditions>
      <add input="{URL}" pattern="^b/" negate="true" />
    </conditions>
    <action type="Redirect" url="{ToLower:{URL}}" />
  </rule>
  
  <rule name="Web form" stopProcessing="true">
    <match url="*.aspx" patternSyntax="Wildcard" />
    <rewrite to="parameter" toIndex="ipAddress" from="serverVariable" fromindex="REMOTE_ADDR"/>
    <rewrite to="parameter" toIndex="method" from="serverVariable" fromindex="REQUEST_METHOD" operation="ToLower"/>
  </rule>
  
  <rule name="Say hello if IIS Express">
    <conditions logicalGrouping="matchAll">
      <add input="{SERVER_PORT}" pattern="53105" />
      <condition scope="path" test="startsWith" value="/hello"/>
    </conditions>
    <action type="CustomResponse" 
            statusLine="HTTP/1.1 200 OK" 
            responseLine="&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Hello&lt;/body&gt;&lt;/html&gt;" />
  </rule>

  <rule name="InfoID Redirect" stopProcessing="true">
    <match url="^/newsblast/nb\.asp$" />
    <conditions logicalGrouping="MatchAll" trackAllCaptures="true">
      <add input="{QUERY_STRING}" pattern="infoid=([\d]+)" />
      <add input="{QUERY_STRING}" pattern="email=(.+)" />
    </conditions>
    <action type="Redirect" url="/test1.aspx?infoid={C:1}&amp;email={C:2}" appendQueryString="false" />
  </rule>

</rules>
